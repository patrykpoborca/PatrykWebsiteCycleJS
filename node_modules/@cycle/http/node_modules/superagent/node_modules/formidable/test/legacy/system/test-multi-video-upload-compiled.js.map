{"version":3,"sources":["test-multi-video-upload.js"],"names":[],"mappings":"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","file":"test-multi-video-upload-compiled.js","sourcesContent":["var common = require('../common');\nvar BOUNDARY = '---------------------------10102754414578508781458777923',\n    FIXTURE = TEST_FIXTURES+'/multi_video.upload',\n    fs = require('fs'),\n    http = require('http'),\n    formidable = require(common.lib + '/index'),\n    server = http.createServer();\n\nserver.on('request', function(req, res) {\n  var form = new formidable.IncomingForm(),\n      uploads = {};\n\n  form.uploadDir = TEST_TMP;\n  form.hash = 'sha1';\n  form.parse(req);\n\n  form\n    .on('fileBegin', function(field, file) {\n      assert.equal(field, 'upload');\n\n      var tracker = {file: file, progress: [], ended: false};\n      uploads[file.name] = tracker;\n      file\n        .on('progress', function(bytesReceived) {\n          tracker.progress.push(bytesReceived);\n          assert.equal(bytesReceived, file.size);\n        })\n        .on('end', function() {\n          tracker.ended = true;\n        });\n    })\n    .on('field', function(field, value) {\n      assert.equal(field, 'title');\n      assert.equal(value, '');\n    })\n    .on('file', function(field, file) {\n      assert.equal(field, 'upload');\n      assert.strictEqual(uploads[file.name].file, file);\n    })\n    .on('end', function() {\n      assert.ok(uploads['shortest_video.flv']);\n      assert.ok(uploads['shortest_video.flv'].ended);\n      assert.ok(uploads['shortest_video.flv'].progress.length > 3);\n      assert.equal(uploads['shortest_video.flv'].file.hash, 'd6a17616c7143d1b1438ceeef6836d1a09186b3a');\n      assert.equal(uploads['shortest_video.flv'].progress.slice(-1), uploads['shortest_video.flv'].file.size);\n      assert.ok(uploads['shortest_video.mp4']);\n      assert.ok(uploads['shortest_video.mp4'].ended);\n      assert.ok(uploads['shortest_video.mp4'].progress.length > 3);\n      assert.equal(uploads['shortest_video.mp4'].file.hash, '937dfd4db263f4887ceae19341dcc8d63bcd557f');\n\n      server.close();\n      res.writeHead(200);\n      res.end('good');\n    });\n});\n\nserver.listen(TEST_PORT, function() {\n  var stat, headers, request, fixture;\n\n  stat = fs.statSync(FIXTURE);\n  request = http.request({\n    port: TEST_PORT,\n    path: '/',\n    method: 'POST',\n    headers: {\n      'content-type': 'multipart/form-data; boundary='+BOUNDARY,\n      'content-length': stat.size,\n    },\n  });\n  fs.createReadStream(FIXTURE).pipe(request);\n});\n"]}