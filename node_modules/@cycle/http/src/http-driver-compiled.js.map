{"version":3,"sources":["http-driver.js"],"names":[],"mappings":"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","file":"http-driver-compiled.js","sourcesContent":["const {Rx} = require(`@cycle/core`)\nconst superagent = require(`superagent`)\n\nfunction optionsToSuperagent({\n  url,\n  send = null,\n  accept = null,\n  query = null,\n  user = null,\n  password = null,\n  field = null,\n  attach = null, // if valid, should be an array\n  withCredentials = false,\n  headers = {},\n  redirects = 5,\n  type = `json`,\n  method = `get`,\n}) {\n  if (typeof url !== `string`) {\n    throw new Error(`Please provide a \\`url\\` property in the request options.`)\n  }\n  const sanitizedMethod = method.toLowerCase()\n  let request = superagent[sanitizedMethod](url)\n  if (typeof request.redirects === `function`) {\n    request = request.redirects(redirects)\n  }\n  request = request.type(type)\n  if (send !== null) {\n    request = request.send(send)\n  }\n  if (accept !== null) {\n    request = request.accept(accept)\n  }\n  if (query !== null) {\n    request = request.query(query)\n  }\n  if (withCredentials) {\n    request = request.withCredentials()\n  }\n  if (user !== null && password !== null) {\n    request = request.auth(user, password)\n  }\n  for (let key in headers) {\n    if (headers.hasOwnProperty(key)) {\n      request = request.set(key, headers[key])\n    }\n  }\n  if (field !== null) {\n    for (let key in field) {\n      if (field.hasOwnProperty(key)) {\n        request = request.field(key, field[key])\n      }\n    }\n  }\n  if (attach !== null) {\n    for (let i = attach.length - 1; i >= 0; i--) {\n      const a = attach[i]\n      request = request.attach(a.name, a.path, a.filename)\n    }\n  }\n  return request\n}\n\nfunction urlToSuperagent(url) {\n  return superagent.get(url)\n}\n\nfunction createResponse$(reqOptions) {\n  return Rx.Observable.create(observer => {\n    let request\n    if (typeof reqOptions === `string`) {\n      request = urlToSuperagent(reqOptions)\n    } else if (typeof reqOptions === `object`) {\n      request = optionsToSuperagent(reqOptions)\n    } else {\n      observer.onError(new Error(`Observable of requests given to HTTP ` +\n        `Driver must emit either URL strings or objects with parameters.`))\n      return () => {} // noop\n    }\n\n    try {\n      request.end((err, res) => {\n        if (err) {\n          observer.onError(err)\n        } else {\n          observer.onNext(res)\n          observer.onCompleted()\n        }\n      })\n    } catch (err) {\n      observer.onError(err)\n    }\n\n    return function onDispose() {\n      request.abort()\n    }\n  })\n}\n\nfunction makeHTTPDriver({autoSubscribe = true} = {autoSubscribe: true}) {\n  return function httpDriver(request$) {\n    let response$$ = request$.map(reqOptions => {\n      let response$ = createResponse$(reqOptions)\n      if (autoSubscribe) {\n        response$ = response$.replay(null, 1)\n        response$.connect()\n      }\n      response$.request = reqOptions\n      return response$\n    })\n    if (autoSubscribe) {\n      response$$ = response$$.replay(null, 1)\n      response$$.connect()\n    }\n    return response$$\n  }\n}\n\nmodule.exports = {\n  optionsToSuperagent,\n  urlToSuperagent,\n  createResponse$,\n\n  makeHTTPDriver,\n}\n"]}